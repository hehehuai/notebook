---
title: "操作系统"
date: 2021-12-27T14:41:32+08:00
weight: 2
draft: true
---


# 操作系统为什么要区分内核态和用户态?
	为了提高操作系统的稳定性和安全性，cpu的指令集中有些比较危险的命令，比如控制硬件资源的的指令,对于开发者有很高的要求，提出用户态和内核态,内核态可用访问所有cpu指令，直接进行硬件直接操作，用户态会限制应用程序的操作，只能访问做地址映射的地址空间，对操作系统形成保护，它只能通过内核态提供的系统调用访问硬件和设备等资源的操作,即使应用程序出错，也不会导致系统崩溃,间接起到保护作用。

# 为什么要多线程
	* 提高应用程序的响应能力
	* 提高应用程序使用cpu的能力
	* 相对于多进程，不需要创建新的地址空间，可用公用内存空间，创建线程和切换开销小
	* 线程通信简单
	
# 进程
	一个执行中的程序实例。它是操作系统分配资源的最小单元
	系统中的每个程序都运行在某个进程的上下文中,上下文是程序正确执行所需状态组成的。它包括内存中的代码，数据，栈，通用寄存器,程序计数器，环境变量，打开的文件描述符的集合
	进程提供给应用程序一种抽象，独立的逻辑控制流，私有的地址空间
	* 并发流
		异常处理流，进程，信号处理，线程
		多个流并发的执行的现象称为并发，一个进程和另一个进程轮流执行称为多任务，一个进程的执行它的控制流的时间段称为时间片
	* 地址空间
		代码、数据、堆、栈
	操作系统内核使用一种上下文切换的较高层次形式的异常控制流实现多任务
	内核为每个进程提供维护一个上下文，上下文是是内核启动一个被抢占进程所需的状态，它由一些对象值组成，这些对象包括通用寄存器，浮点寄存器，程序技术器，用户栈，状态寄存器，内核栈和数据结构比如页表，包含当前进程的信息的进程表，以及进程打开的文件信息的文件表。
	进程执行过程中，内核可用决定抢占当前进程，重新打开先前被抢占的进程，这种决策就叫做调度
	上下文切换机制将控制转移到新的进程，分三步:1)保存当前进程上下文;2)恢复先前被抢占的进程上下文;3)将控制权交给新恢复的进程
	* 回收进程
		如果一个进程终止，内核并不会立即从系统中清除，进程会保存一种终止状态，等待父进程回收，父进程回收已经终止的子进程时，内核将子进程状态的状态传递给父进程，然后销毁已经终止的子进程，进程就不存在了，一个终止了但是还没有被回收的进程称为僵尸进程。如果父进程已经终止，内核会安排init进程成为成为孤儿进程的养父。如果父进程没有回收僵死的子进程，内核会安排init进程去回收他们。
	系统中的进程是共享cpu和内存资源的，如果直接访问会造成有些没有内存资源无法运行，而且由于其他进程对内存的更改导致令人迷惑的问题。为了更好管理内存，需要对资源进行抽象，通过虚拟内存来管理
	1)可以保持活动区域，根据需要在内存和磁盘之间来回传递数据
	2)为进程提供一致的内存空间，可以简化内存管理。
	3）保证地址空间不被其他进程破坏。
# 线程
	线程是运行在进程上下文中的逻辑流，线程是由内核调度，有自己的线程上下文，线程id，通用寄存器，栈，栈指针，程序计数器，和条件码


# 内核线程 用户线程
	内核线程是os内核可以感知的，用户线程是不可感知的。
	用户线程的的创建是语言层次的，
